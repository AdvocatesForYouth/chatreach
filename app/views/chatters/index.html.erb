<% content_for :javascript do %>
<%= javascript_include_tag "quicksearch.js", :cache => true %>
<script type="text/javascript">
$(document).ready(function() {        
	$('table#tableList tbody tr').quicksearch({
	  position: 'before',
	  attached: 'table#tableList',
	  stripeRowClass: ['odd', 'even'],
	  labelText: 'Search the table',
	  inputClass: 'text'
	}); 
});
</script>
<% end %>
<div id="questionList">
<h1>Chatters for <%=@brand.name%></h1>
<%= render "menu"%>
<table id="tableList" class="tablesorter">
  <thead>
    <th>Zipcode</th>
    <th>Date</th>
	  <th>Sessions</th>
	  <th>Texts</th>	  
	  <th>Referrals</th>	  
    <th>Action</th>	  
  </thead>

<% @chatters.order("created_at DESC").uniq.each do |chatter| %>
  <tr>
  <td><%=chatter.zipcode%></td>
  <td><%=chatter.created_at.strftime("%Y-%m-%d")%>
  <td><%=chatter.text_sessions.size%></td>
  <td><%=TextHistory.joins(:text_session).where("text_sessions.brand_id = #{@brand.id} and text_session_id IN (#{chatter.text_sessions.map(&:id).join(", ")})").size%></td>
  <td><%=TextHistory.joins(:text_session).where("text_sessions.brand_id = #{@brand.id} and text_session_id IN (#{chatter.text_sessions.map(&:id).join(", ")}) and text_type='help'").size%></td>      
    <td><%=link_to "Show Chatter", chatter%></td>  
  </tr>
<% end %>
</table>
<%= will_paginate @chatters %>

</div>